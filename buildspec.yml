version: 0.2

env:
    variables:
        CACHE_CONTROL: "86400"
        S3_BUCKET: "{{s3_bucket_url}}"
        BUILD_FOLDER: "dist"
phases:
  install:
    runtime-versions:
        nodejs: 12
    commands:
        - echo Installing source NPM dependencies...
        - npm install
        - npm install -g @angular/cli
        - export SONAR_SCANNER_VERSION=4.4.0.2170
        - export SONAR_SCANNER_HOME=$HOME/.sonar/sonar-scanner-$SONAR_SCANNER_VERSION-linux
        - curl --create-dirs -sSLo $HOME/.sonar/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_VERSION-linux.zip
        - unzip -o $HOME/.sonar/sonar-scanner.zip -d $HOME/.sonar/
        - export PATH=$SONAR_SCANNER_HOME/bin:$PATH
        - export SONAR_SCANNER_OPTS="-server"
        - sonar-scanner \
  -Dsonar.organization=adarsha1999 \
  -Dsonar.projectKey=angular_ci_cd \
  -Dsonar.sources=. \
  -Dsonar.host.url=https://sonarcloud.io

  build:
    commands:
        - echo Build started 
        - ng build
        

artifacts:
    files:
        - '**/*'
    type: zip
    base-directory: 'dist*'
    discard-paths: yes
